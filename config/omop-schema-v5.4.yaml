# This file programmatically defines the OMOP CDM v5.4 schema
# It is derived from the postgresql DDL script provided by the OMOP CDM
#
# Data types are mapped to a simplified set for Pandas compatibility:
# - integer -> int
# - date/timestamp -> datetime64[ns]
# - varchar/text -> str (or str in Python)
# - numeric -> float
#
# Primary and foreign keys are based on standard OMOP conventions.

tables:
  - name: person
    primary_key: person_id
    required_columns:
      - person_id
      - gender_concept_id
      - year_of_birth
      - race_concept_id
      - ethnicity_concept_id
    datatypes:
      person_id: int
      gender_concept_id: int
      year_of_birth: int
      month_of_birth: int
      day_of_birth: int
      birth_datetime: datetime64[ns]
      race_concept_id: int
      ethnicity_concept_id: int
      location_id: int
      provider_id: int
      care_site_id: int
      person_source_value: str
      gender_source_value: str
      gender_source_concept_id: int
      race_source_value: str
      race_source_concept_id: int
      ethnicity_source_value: str
      ethnicity_source_concept_id: int

  - name: observation_period
    primary_key: observation_period_id
    required_columns:
      - observation_period_id
      - person_id
      - observation_period_start_date
      - observation_period_end_date
      - period_type_concept_id
    datatypes:
      observation_period_id: int
      person_id: int
      observation_period_start_date: datetime64[ns]
      observation_period_end_date: datetime64[ns]
      period_type_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id

  - name: visit_occurrence
    primary_key: visit_occurrence_id
    required_columns:
      - visit_occurrence_id
      - person_id
      - visit_concept_id
      - visit_start_date
      - visit_end_date
      - visit_type_concept_id
    datatypes:
      visit_occurrence_id: int
      person_id: int
      visit_concept_id: int
      visit_start_date: datetime64[ns]
      visit_start_datetime: datetime64[ns]
      visit_end_date: datetime64[ns]
      visit_end_datetime: datetime64[ns]
      visit_type_concept_id: int
      provider_id: int
      care_site_id: int
      visit_source_value: str
      visit_source_concept_id: int
      admitted_from_concept_id: int
      admitted_from_source_value: str
      discharged_to_concept_id: int
      discharged_to_source_value: str
      preceding_visit_occurrence_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: care_site_id
        references: care_site.care_site_id
      - column: preceding_visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id

  - name: visit_detail
    primary_key: visit_detail_id
    required_columns:
      - visit_detail_id
      - person_id
      - visit_detail_concept_id
      - visit_detail_start_date
      - visit_detail_end_date
      - visit_detail_type_concept_id
      - visit_occurrence_id
    datatypes:
      visit_detail_id: int
      person_id: int
      visit_detail_concept_id: int
      visit_detail_start_date: datetime64[ns]
      visit_detail_start_datetime: datetime64[ns]
      visit_detail_end_date: datetime64[ns]
      visit_detail_end_datetime: datetime64[ns]
      visit_detail_type_concept_id: int
      provider_id: int
      care_site_id: int
      visit_detail_source_value: str
      visit_detail_source_concept_id: int
      admitted_from_concept_id: int
      admitted_from_source_value: str
      discharged_to_source_value: str
      discharged_to_concept_id: int
      preceding_visit_detail_id: int
      parent_visit_detail_id: int
      visit_occurrence_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: care_site_id
        references: care_site.care_site_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id

  - name: condition_occurrence
    primary_key: condition_occurrence_id
    required_columns:
      - condition_occurrence_id
      - person_id
      - condition_concept_id
      - condition_start_date
      - condition_type_concept_id
    datatypes:
      condition_occurrence_id: int
      person_id: int
      condition_concept_id: int
      condition_start_date: datetime64[ns]
      condition_start_datetime: datetime64[ns]
      condition_end_date: datetime64[ns]
      condition_end_datetime: datetime64[ns]
      condition_type_concept_id: int
      condition_status_concept_id: int
      stop_reason: str
      provider_id: int
      visit_occurrence_id: int
      visit_detail_id: int
      condition_source_value: str
      condition_source_concept_id: int
      condition_status_source_value: str
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id
      - column: visit_detail_id
        references: visit_detail.visit_detail_id

  - name: drug_exposure
    primary_key: drug_exposure_id
    required_columns:
      - drug_exposure_id
      - person_id
      - drug_concept_id
      - drug_exposure_start_date
      - drug_exposure_end_date
      - drug_type_concept_id
    datatypes:
      drug_exposure_id: int
      person_id: int
      drug_concept_id: int
      drug_exposure_start_date: datetime64[ns]
      drug_exposure_start_datetime: datetime64[ns]
      drug_exposure_end_date: datetime64[ns]
      drug_exposure_end_datetime: datetime64[ns]
      verbatim_end_date: datetime64[ns]
      drug_type_concept_id: int
      stop_reason: str
      refills: int
      quantity: float
      days_supply: int
      sig: str
      route_concept_id: int
      lot_number: str
      provider_id: int
      visit_occurrence_id: int
      visit_detail_id: int
      drug_source_value: str
      drug_source_concept_id: int
      route_source_value: str
      dose_unit_source_value: str
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id
      - column: visit_detail_id
        references: visit_detail.visit_detail_id

  - name: procedure_occurrence
    primary_key: procedure_occurrence_id
    required_columns:
      - procedure_occurrence_id
      - person_id
      - procedure_concept_id
      - procedure_date
      - procedure_type_concept_id
    datatypes:
      procedure_occurrence_id: int
      person_id: int
      procedure_concept_id: int
      procedure_date: datetime64[ns]
      procedure_datetime: datetime64[ns]
      procedure_end_date: datetime64[ns]
      procedure_end_datetime: datetime64[ns]
      procedure_type_concept_id: int
      modifier_concept_id: int
      quantity: int
      provider_id: int
      visit_occurrence_id: int
      visit_detail_id: int
      procedure_source_value: str
      procedure_source_concept_id: int
      modifier_source_value: str
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id
      - column: visit_detail_id
        references: visit_detail.visit_detail_id

  - name: device_exposure
    primary_key: device_exposure_id
    required_columns:
      - device_exposure_id
      - person_id
      - device_concept_id
      - device_exposure_start_date
      - device_type_concept_id
    datatypes:
      device_exposure_id: int
      person_id: int
      device_concept_id: int
      device_exposure_start_date: datetime64[ns]
      device_exposure_start_datetime: datetime64[ns]
      device_exposure_end_date: datetime64[ns]
      device_exposure_end_datetime: datetime64[ns]
      device_type_concept_id: int
      unique_device_id: str
      production_id: str
      quantity: int
      provider_id: int
      visit_occurrence_id: int
      visit_detail_id: int
      device_source_value: str
      device_source_concept_id: int
      unit_concept_id: int
      unit_source_value: str
      unit_source_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id
      - column: visit_detail_id
        references: visit_detail.visit_detail_id

  - name: measurement
    primary_key: measurement_id
    required_columns:
      - measurement_id
      - person_id
      - measurement_concept_id
      - measurement_date
      - measurement_type_concept_id
    datatypes:
      measurement_id: int
      person_id: int
      measurement_concept_id: int
      measurement_date: datetime64[ns]
      measurement_datetime: datetime64[ns]
      measurement_time: str
      measurement_type_concept_id: int
      operator_concept_id: int
      value_as_number: float
      value_as_concept_id: int
      unit_concept_id: int
      range_low: float
      range_high: float
      provider_id: int
      visit_occurrence_id: int
      visit_detail_id: int
      measurement_source_value: str
      measurement_source_concept_id: int
      unit_source_value: str
      unit_source_concept_id: int
      value_source_value: str
      measurement_event_id: int
      meas_event_field_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id
      - column: visit_detail_id
        references: visit_detail.visit_detail_id

  - name: observation
    primary_key: observation_id
    required_columns:
      - observation_id
      - person_id
      - observation_concept_id
      - observation_date
      - observation_type_concept_id
    datatypes:
      observation_id: int
      person_id: int
      observation_concept_id: int
      observation_date: datetime64[ns]
      observation_datetime: datetime64[ns]
      observation_type_concept_id: int
      value_as_number: float
      value_as_string: str
      value_as_concept_id: int
      qualifier_concept_id: int
      unit_concept_id: int
      provider_id: int
      visit_occurrence_id: int
      visit_detail_id: int
      observation_source_value: str
      observation_source_concept_id: int
      unit_source_value: str
      qualifier_source_value: str
      value_source_value: str
      observation_event_id: int
      obs_event_field_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id
      - column: visit_detail_id
        references: visit_detail.visit_detail_id

  - name: death
    primary_key: person_id
    required_columns:
      - person_id
      - death_date
    datatypes:
      person_id: int
      death_date: datetime64[ns]
      death_datetime: datetime64[ns]
      death_type_concept_id: int
      cause_concept_id: int
      cause_source_value: str
      cause_source_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id

  - name: note
    primary_key: note_id
    required_columns:
      - note_id
      - person_id
      - note_date
      - note_type_concept_id
      - note_class_concept_id
      - note_text
      - encoding_concept_id
      - language_concept_id
    datatypes:
      note_id: int
      person_id: int
      note_date: datetime64[ns]
      note_datetime: datetime64[ns]
      note_type_concept_id: int
      note_class_concept_id: int
      note_title: str
      note_text: str
      encoding_concept_id: int
      language_concept_id: int
      provider_id: int
      visit_occurrence_id: int
      visit_detail_id: int
      note_source_value: str
      note_event_id: int
      note_event_field_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: provider_id
        references: provider.provider_id
      - column: visit_occurrence_id
        references: visit_occurrence.visit_occurrence_id
      - column: visit_detail_id
        references: visit_detail.visit_detail_id

  - name: note_nlp
    primary_key: note_nlp_id
    required_columns:
      - note_nlp_id
      - note_id
      - lexical_variant
      - nlp_date
    datatypes:
      note_nlp_id: int
      note_id: int
      section_concept_id: int
      snippet: str
      offset: str
      lexical_variant: str
      note_nlp_concept_id: int
      note_nlp_source_concept_id: int
      nlp_system: str
      nlp_date: datetime64[ns]
      nlp_datetime: datetime64[ns]
      term_exists: str
      term_temporal: str
      term_modifiers: str
    foreign_keys:
      - column: note_id
        references: note.note_id

  - name: specimen
    primary_key: specimen_id
    required_columns:
      - specimen_id
      - person_id
      - specimen_concept_id
      - specimen_type_concept_id
      - specimen_date
    datatypes:
      specimen_id: int
      person_id: int
      specimen_concept_id: int
      specimen_type_concept_id: int
      specimen_date: datetime64[ns]
      specimen_datetime: datetime64[ns]
      quantity: float
      unit_concept_id: int
      anatomic_site_concept_id: int
      disease_status_concept_id: int
      specimen_source_id: str
      specimen_source_value: str
      unit_source_value: str
      anatomic_site_source_value: str
      disease_status_source_value: str
    foreign_keys:
      - column: person_id
        references: person.person_id

  - name: fact_relationship
    primary_key:
    required_columns:
      - domain_concept_id_1
      - fact_id_1
      - domain_concept_id_2
      - fact_id_2
      - relationship_concept_id
    datatypes:
      domain_concept_id_1: int
      fact_id_1: int
      domain_concept_id_2: int
      fact_id_2: int
      relationship_concept_id: int
    foreign_keys:
      - column: domain_concept_id_1
        references: domain.domain_concept_id
      - column: domain_concept_id_2
        references: domain.domain_concept_id
      - column: relationship_concept_id
        references: concept.concept_id

  - name: location
    primary_key: location_id
    required_columns:
      - location_id
    datatypes:
      location_id: int
      address_1: str
      address_2: str
      city: str
      state: str
      zip: str
      county: str
      location_source_value: str
      country_concept_id: int
      country_source_value: str
      latitude: float
      longitude: float

  - name: care_site
    primary_key: care_site_id
    required_columns:
      - care_site_id
    datatypes:
      care_site_id: int
      care_site_name: str
      place_of_service_concept_id: int
      location_id: int
      care_site_source_value: str
      place_of_service_source_value: str
    foreign_keys:
      - column: location_id
        references: location.location_id

  - name: provider
    primary_key: provider_id
    required_columns:
      - provider_id
    datatypes:
      provider_id: int
      provider_name: str
      npi: str
      dea: str
      specialty_concept_id: int
      care_site_id: int
      year_of_birth: int
      gender_concept_id: int
      provider_source_value: str
      specialty_source_value: str
      specialty_source_concept_id: int
      gender_source_value: str
      gender_source_concept_id: int
    foreign_keys:
      - column: care_site_id
        references: care_site.care_site_id

  - name: payer_plan_period
    primary_key: payer_plan_period_id
    required_columns:
      - payer_plan_period_id
      - person_id
      - payer_plan_period_start_date
      - payer_plan_period_end_date
    datatypes:
      payer_plan_period_id: int
      person_id: int
      payer_plan_period_start_date: datetime64[ns]
      payer_plan_period_end_date: datetime64[ns]
      payer_concept_id: int
      payer_source_value: str
      payer_source_concept_id: int
      plan_concept_id: int
      plan_source_value: str
      plan_source_concept_id: int
      sponsor_concept_id: int
      sponsor_source_value: str
      sponsor_source_concept_id: int
      family_source_value: str
      stop_reason_concept_id: int
      stop_reason_source_value: str
      stop_reason_source_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: payer_plan_period_id
        references: payer_plan_period.payer_plan_period_id

  - name: cost
    primary_key: cost_id
    required_columns:
      - cost_id
      - cost_event_id
      - cost_domain_id
      - cost_type_concept_id
    datatypes:
      cost_id: int
      cost_event_id: int
      cost_domain_id: str
      cost_type_concept_id: int
      currency_concept_id: int
      total_charge: float
      total_cost: float
      total_paid: float
      paid_by_payer: float
      paid_by_patient: float
      paid_patient_copay: float
      paid_patient_coinsurance: float
      paid_patient_deductible: float
      paid_by_primary: float
      paid_ingredient_cost: float
      paid_dispensing_fee: float
      payer_plan_period_id: int
      amount_allowed: float
      revenue_code_concept_id: int
      revenue_code_source_value: str
      drg_concept_id: int
      drg_source_value: str
    foreign_keys:
      - column: payer_plan_period_id
        references: payer_plan_period.payer_plan_period_id

  - name: drug_era
    primary_key: drug_era_id
    required_columns:
      - drug_era_id
      - person_id
      - drug_concept_id
      - drug_era_start_date
      - drug_era_end_date
    datatypes:
      drug_era_id: int
      person_id: int
      drug_concept_id: int
      drug_era_start_date: datetime64[ns]
      drug_era_end_date: datetime64[ns]
      drug_exposure_count: int
      gap_days: int
    foreign_keys:
      - column: person_id
        references: person.person_id

  - name: dose_era
    primary_key: dose_era_id
    required_columns:
      - dose_era_id
      - person_id
      - drug_concept_id
      - unit_concept_id
      - dose_value
      - dose_era_start_date
      - dose_era_end_date
    datatypes:
      dose_era_id: int
      person_id: int
      drug_concept_id: int
      unit_concept_id: int
      dose_value: float
      dose_era_start_date: datetime64[ns]
      dose_era_end_date: datetime64[ns]
    foreign_keys:
      - column: person_id
        references: person.person_id

  - name: condition_era
    primary_key: condition_era_id
    required_columns:
      - condition_era_id
      - person_id
      - condition_concept_id
      - condition_era_start_date
      - condition_era_end_date
    datatypes:
      condition_era_id: int
      person_id: int
      condition_concept_id: int
      condition_era_start_date: datetime64[ns]
      condition_era_end_date: datetime64[ns]
      condition_occurrence_count: int
    foreign_keys:
      - column: person_id
        references: person.person_id

  - name: episode
    primary_key: episode_id
    required_columns:
      - episode_id
      - person_id
      - episode_concept_id
      - episode_start_date
      - episode_str_concept_id
      - episode_type_concept_id
    datatypes:
      episode_id: int
      person_id: int
      episode_concept_id: int
      episode_start_date: datetime64[ns]
      episode_start_datetime: datetime64[ns]
      episode_end_date: datetime64[ns]
      episode_end_datetime: datetime64[ns]
      episode_parent_id: int
      episode_number: int
      episode_str_concept_id: int
      episode_type_concept_id: int
      episode_source_value: str
      episode_source_concept_id: int
    foreign_keys:
      - column: person_id
        references: person.person_id
      - column: episode_parent_id
        references: episode.episode_id

  - name: episode_event
    required_columns:
      - episode_id
      - event_id
      - episode_event_field_concept_id
    datatypes:
      episode_id: int
      event_id: int
      episode_event_field_concept_id: int
    foreign_keys:
      - column: episode_id
        references: episode.episode_id

  - name: metadata
    primary_key: metadata_id
    required_columns:
      - metadata_id
      - metadata_concept_id
      - metadata_type_concept_id
      - name
    datatypes:
      metadata_id: int
      metadata_concept_id: int
      metadata_type_concept_id: int
      name: str
      value_as_string: str
      value_as_concept_id: int
      value_as_number: float
      metadata_date: datetime64[ns]
      metadata_datetime: datetime64[ns]

  - name: cdm_source
    required_columns:
      - cdm_source_name
      - cdm_source_abbreviation
      - cdm_holder
      - source_release_date
      - cdm_release_date
      - cdm_version_concept_id
      - vocabulary_version
    datatypes:
      cdm_source_name: str
      cdm_source_abbreviation: str
      cdm_holder: str
      source_description: str
      source_documentation_reference: str
      cdm_etl_reference: str
      source_release_date: datetime64[ns]
      cdm_release_date: datetime64[ns]
      cdm_version: str
      cdm_version_concept_id: int
      vocabulary_version: str

  - name: concept
    primary_key: concept_id
    required_columns:
      - concept_id
      - concept_name
      - domain_id
      - vocabulary_id
      - concept_class_id
      - concept_code
      - valid_start_date
      - valid_end_date
    datatypes:
      concept_id: int
      concept_name: str
      domain_id: str
      vocabulary_id: str
      concept_class_id: str
      standard_concept: str
      concept_code: str
      valid_start_date: datetime64[ns]
      valid_end_date: datetime64[ns]
      invalid_reason: str

  - name: vocabulary
    primary_key: vocabulary_id
    required_columns:
      - vocabulary_id
      - vocabulary_name
      - vocabulary_concept_id
    datatypes:
      vocabulary_id: str
      vocabulary_name: str
      vocabulary_reference: str
      vocabulary_version: str
      vocabulary_concept_id: int

  - name: domain
    primary_key: domain_id
    required_columns:
      - domain_id
      - domain_name
      - domain_concept_id
    datatypes:
      domain_id: str
      domain_name: str
      domain_concept_id: int

  - name: concept_class
    primary_key: concept_class_id
    required_columns:
      - concept_class_id
      - concept_class_name
      - concept_class_concept_id
    datatypes:
      concept_class_id: str
      concept_class_name: str
      concept_class_concept_id: int

  - name: concept_relationship
    primary_key:
      - concept_id_1
      - concept_id_2
      - relationship_id
    required_columns:
      - concept_id_1
      - concept_id_2
      - relationship_id
      - valid_start_date
      - valid_end_date
    datatypes:
      concept_id_1: int
      concept_id_2: int
      relationship_id: str
      valid_start_date: datetime64[ns]
      valid_end_date: datetime64[ns]
      invalid_reason: str
    foreign_keys:
      - column: concept_id_1
        references: concept.concept_id
      - column: concept_id_2
        references: concept.concept_id
      - column: relationship_id
        references: relationship.relationship_id

  - name: relationship
    primary_key: relationship_id
    required_columns:
      - relationship_id
      - relationship_name
      - is_hierarchical
      - defines_ancestry
      - reverse_relationship_id
      - relationship_concept_id
    datatypes:
      relationship_id: str
      relationship_name: str
      is_hierarchical: str
      defines_ancestry: str
      reverse_relationship_id: str
      relationship_concept_id: int
      foreign_keys:
       - column: relationship_concept_id
       - references: concept.concept_id

  - name: concept_synonym
    primary_key:
      - concept_id
      - concept_synonrrrym_name
      - language_concept_id
    required_columns:
      - concept_id
      - concept_synonym_name
      - language_concept_id
    datatypes:
      concept_id: int
      concept_synonym_name: str
      language_concept_id: int
    foreign_keys:
      - column: concept_id
        references: concept.concept_id
      - column: language_concept_id
        references: concept.concept_id

  - name: concept_ancestor
    primary_key:
      - ancestor_concept_id
      - descendant_concept_id
    required_columns:
      - ancestor_concept_id
      - descendant_concept_id
      - min_levels_of_separation
      - max_levels_of_separation
    datatypes:
      ancestor_concept_id: int
      descendant_concept_id: int
      min_levels_of_separation: int
      max_levels_of_separation: int
    foreign_keys:
      - column: ancestor_concept_id
        references: concept.concept_id
      - column: descendant_concept_id
        references: concept.concept_id

  - name: source_to_concept_map
    required_columns:
      - source_code
      - source_concept_id
      - source_vocabulary_id
      - target_concept_id
      - target_vocabulary_id
      - valid_start_date
      - valid_end_date
    datatypes:
      source_code: str
      source_concept_id: int
      source_vocabulary_id: str
      source_code_description: str
      target_concept_id: int
      target_vocabulary_id: str
      valid_start_date: datetime64[ns]
      valid_end_date: datetime64[ns]
      invalid_reason: str
    foreign_keys:
      - column: source_concept_id
        references: concept.concept_id
      - column: target_concept_id
        references: concept.concept_id

  - name: drug_strength
    required_columns:
      - drug_concept_id
      - ingredient_concept_id
      - valid_start_date
      - valid_end_date
    datatypes:
      drug_concept_id: int
      ingredient_concept_id: int
      amount_value: float
      amount_unit_concept_id: int
      numerator_value: float
      numerator_unit_concept_id: int
      denominator_value: float
      denominator_unit_concept_id: int
      box_size: int
      valid_start_date: datetime64[ns]
      valid_end_date: datetime64[ns]
      invalid_reason: str
    foreign_keys:
      - column: drug_concept_id
        references: concept.concept_id
      - column: ingredient_concept_id
        references: concept.concept_id

  - name: cohort
    required_columns:
      - cohort_definition_id
      - subject_id
      - cohort_start_date
      - cohort_end_date
    datatypes:
      cohort_definition_id: int
      subject_id: int
      cohort_start_date: datetime64[ns]
      cohort_end_date: datetime64[ns]
    foreign_keys:
      - column: cohort_definition_id
        references: cohort_definition.cohort_definition_id

  - name: cohort_definition
    primary_key: cohort_definition_id
    required_columns:
      - cohort_definition_id
      - cohort_definition_name
      - definition_type_concept_id
      - subject_concept_id
    datatypes:
      cohort_definition_id: int
      cohort_definition_name: str
      cohort_definition_description: str
      definition_type_concept_id: int
      cohort_definition_syntax: str
      subject_concept_id: int
      cohort_initiation_date: datetime64[ns]